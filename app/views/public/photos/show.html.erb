<% content_for(:title, '投稿詳細') %>

<div class="container">
  <div class="row justify-content-center md-5">
    <div class="col-lg-8 mt-4">
      <div class="card-deck bg-dark text-white">
      <%= image_tag @photo.get_image, class: "card-img-top"; %>
        <div class="card-body">
          <p class="card-title">タイトル:<%= @photo.title %></p>
          <p class="card-text">コメント:<%= @photo.body %></p>
          <p><%= image_tag @photo.user.get_profile_image(100,100), class: "mt-3 rounded-circle"; %></p>
          <p>ユーザー:<%= @photo.user.name %> | 投稿日:<%= @photo.created_at.strftime('%Y/%m/%d') %></p>
          
            <% if @photo.user == current_user %>
              <%= link_to "削除", photo_path(@photo), method: :delete %>
            <% end %>

            <% if @photo.favorited_by?(current_user) %>
            <p>
              <%= link_to photo_favorites_path(@photo), method: :delete do %>
                ♥<%= @photo.favorites.count %> いいね
              <% end %>
            </p>
              <% else %>
            <p>
              <%= link_to photo_favorites_path(@photo), method: :post do %>
                ♡<%= @photo.favorites.count %> いいね
              <% end %>
            </p>
           <% end %>

        <div>
          <% @photo_tags.each do |tag| %>
            <i class="fa-sharp fa-solid fa-tag"></i>
            <%= link_to tag.tag_name, search_path(tag_id: tag.id) %>
          <% end %>
        </div>
      </div>

        <div>
          <p>コメント件数:<%= @photo.photo_comments.count %></p>
            <% @photo.photo_comments.each do |photo_comment| %>
              <p><%= image_tag photo_comment.user.get_profile_image(100,100), class: "mt-3 rounded-circle"; %></p>
                <%= photo_comment.user.name %>
                <%= photo_comment.created_at.strftime('%Y/%m/%d') %><%= photo_comment.comment %>
                  <% if photo_comment.user == current_user %>
                    <%= link_to "削除", photo_photo_comment_path(photo_comment.photo, photo_comment), method: :delete %>
                  <% end %>
            <% end %>
        </div>

        <div>
          <%= form_with model: [@photo, @photo_comment] do |f| %>
            <%= f.text_area :comment, rows: '5', placeholder: "コメントをここに" %>
            <%= f.submit "送信する" %>
          <% end %>
        </div>
    </div>
  </div>
</div>